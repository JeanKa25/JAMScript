#!/bin/bash

SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

die() {
    printf '%s\n' "$1" >&2
    exit 1
}

show_usage() {
    cat << EOF
TODO: make help
EOF
}

while :; do
    case $1 in
        --help)
            show_usage
            exit
            ;;
	--app=?*)
	    app=${1#*=}
	    break
	    ;;
	--remote=)
	die 'ERROR: "--app" requires a non-empty option argument.'
	;;
	--remote=?*)
	    remote=${1#*=}
	    break
	    ;;
	--remote=)
	die 'ERROR: "--remote" requires a non-empty option argument.'
	;;
	*)
            break
    esac
    shift
done

if [ -z "$remote" ]; then
    node $SCRIPT_DIR/jamvis_internal/serv.js $app
    #open "localhost:8580"
else
    echo "Connecting to remote."
    (sleep 3000 && open "http://localhost:8580") &
    ssh -t -t -L 8580:localhost:8580 -L 8681:localhost:8681 $remote ". ~/.bashrc && jamvis --app=$app"
fi


